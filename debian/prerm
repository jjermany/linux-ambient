#!/bin/bash
# Pre-removal script for ambient-brightness package

set -e

# Stop all user instances of the service
if command -v systemctl >/dev/null 2>&1; then
    for user_id in $(loginctl list-users --no-legend 2>/dev/null | awk '{print $1}'); do
        username="$(loginctl show-user "$user_id" -p Name --value 2>/dev/null)"
        if [ -n "$username" ]; then
            su - "$username" -c "systemctl --user stop ambient-brightness 2>/dev/null || true" 2>/dev/null || true
            su - "$username" -c "systemctl --user disable ambient-brightness 2>/dev/null || true" 2>/dev/null || true
        fi
    done
fi

exit 0
